"0","#| output: false"
"0",""
"0","# Plot calls by day of week"
"0","p_day = data %>%"
"0","  count(Day.of.week) %>%"
"0","  ggplot(aes(x = reorder(Day.of.week, n), y = n)) +"
"0","  geom_bar(stat = ""identity"", fill = ""steelblue"") +"
"0","  labs(title = ""Number of Calls by Day of Week"", "
"0","       x = ""Day of Week"", y = ""Number of Calls"") +"
"0","  coord_flip() + theme_minimal()"
"0",""
"0","ggsave(p_day, filename = here(""docs"", ""figures"", ""hist_dayofweek.png""))"
"2","[38;5;232mSaving 7 x 7 in image[39m"
"0","# Plot calls by month"
"0","p_month = data %>%"
"0","  count(month) %>%"
"0","  ggplot(aes(x = reorder(factor(month, labels = c(""January"", ""February"", ""March"","
"0","                                          ""April"", ""May"", ""June"", ""July"", ""August"","
"0","                                          ""September"", ""October"", ""November"", "
"0","                                          ""December"")),n), y = n)) +"
"0","  geom_bar(stat = ""identity"", fill = ""lightblue"") +"
"0","  labs(title = ""Number of Calls by Month"", "
"0","       x = ""Month"", y = ""Number of Calls"") +"
"0","  coord_flip() + theme_minimal()"
"0","ggsave(p_month, filename = here(""docs"", ""figures"", ""hist_month.png""))"
"0",""
"0","# Create heat map of day of week v.s. hour"
"0","# Aggregate calls by day_of_week and block"
"0","aggregated_data <- data %>%"
"0","  group_by(Day.of.week, block) %>%"
"0","  summarise(call_count = n()) %>%"
"0","  ungroup()"
"0",""
"0","# Ensure the day_of_week is ordered from Monday to Sunday"
"0","aggregated_data$day_of_week <- factor(aggregated_data$Day.of.week, "
"0","                                     levels = c(""Monday"", ""Tuesday"", ""Wednesday"", ""Thursday"", "
"0","                                                ""Friday"", ""Saturday"", ""Sunday""))"
"0",""
"0","# Create the heatmap"
"0","p_heatmap <- ggplot(aggregated_data, aes(x = block, y = day_of_week, fill = call_count)) +"
"0","  geom_tile(color = ""white"", width = 0.9, height = 0.9) +  # Adjust width here"
"0","  scale_fill_viridis(name = ""Number of Calls"", option = ""G"") +"
"0","  labs("
"0","    title = ""Heatmap of Fire Suppression Calls by Time of Day and Day of Week"","
"0","    x = ""Time Block"","
"0","    y = ""Day of Week"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    axis.text.x = element_text(angle = 90, hjust = 1),"
"0","    panel.grid = element_blank()"
"0","  ) +"
"0","  coord_fixed(ratio = 0.5)"
"0",""
"0","ggsave(p_heatmap, filename = here(""docs"", ""figures"", ""heatmap.png""))"
"0",""
"0","# Plot calls by hour"
"0","p_hour = data %>%"
"0","  count(hour) %>%"
"0","  ggplot(aes(x = hour, y = n)) +"
"0","  geom_line() +"
"0","  labs(title = ""Number of Calls by Hour"", "
"0","       x = ""Hour of Day"", y = ""Number of Calls"") +"
"0","  scale_x_continuous("
"0","    breaks = 0:23, "
"0","    labels = c(""12:00 AM"", ""1:00 AM"", ""2:00 AM"", ""3:00 AM"", ""4:00 AM"", "
"0","               ""5:00 AM"", ""6:00 AM"", ""7:00 AM"", ""8:00 AM"", ""9:00 AM"", "
"0","               ""10:00 AM"", ""11:00 AM"", ""12:00 PM"", ""1:00 PM"", ""2:00 PM"", "
"0","               ""3:00 PM"", ""4:00 PM"", ""5:00 PM"", ""6:00 PM"", ""7:00 PM"", "
"0","               ""8:00 PM"", ""9:00 PM"", ""10:00 PM"", ""11:00 PM""),"
"0","    expand = c(0, 0)"
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    axis.text.x = element_text(angle = 45, hjust = 1, size = 10, color = ""gray30""),"
"0","    panel.grid.major = element_line(color = ""gray90""),"
"0","    panel.grid.minor = element_blank(),"
"0","    panel.background = element_rect(fill = ""white"", color = NA)"
"0","  )"
"0",""
"0","ggsave(p_hour, filename = here(""docs"", ""figures"", ""counts_by_hr.png""))"
"0",""
"0","# Plot calls by hour and day of week"
"0","p_hourbyday = data %>% group_by(Day.of.week) %>% count(hour) %>%"
"0","  ggplot(aes(x = hour, y = n, color = Day.of.week)) +"
"0","  geom_line() +"
"0","  labs(title = ""Number of Calls by Hour Grouped by Day of Week"", "
"0","       x = ""Hour of Day"", y = ""Number of Calls"", color = ""Day of Week"") +"
"0","  scale_x_continuous("
"0","    breaks = 0:23, "
"0","    labels = c(""12:00 AM"", ""1:00 AM"", ""2:00 AM"", ""3:00 AM"", ""4:00 AM"", "
"0","               ""5:00 AM"", ""6:00 AM"", ""7:00 AM"", ""8:00 AM"", ""9:00 AM"", "
"0","               ""10:00 AM"", ""11:00 AM"", ""12:00 PM"", ""1:00 PM"", ""2:00 PM"", "
"0","               ""3:00 PM"", ""4:00 PM"", ""5:00 PM"", ""6:00 PM"", ""7:00 PM"", "
"0","               ""8:00 PM"", ""9:00 PM"", ""10:00 PM"", ""11:00 PM""),"
"0","    expand = c(0, 0)"
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    axis.text.x = element_text(angle = 45, hjust = 1, size = 10, color = ""gray30""),"
"0","    panel.grid.major = element_line(color = ""gray90""),"
"0","    panel.grid.minor = element_blank(),"
"0","    panel.background = element_rect(fill = ""white"", color = NA)"
"0","  )"
"0","ggsave(p_hourbyday, filename = here(""docs"", ""figures"", ""counts_by_hrday.png""))"
"0",""
"0","# Plot calls by hour and month "
"0","p_hourbymonth = data %>% mutate(month = factor(month, labels = c(""January"", ""February"", ""March"","
"0","                                          ""April"", ""May"", ""June"", ""July"", ""August"","
"0","                                          ""September"", ""October"", ""November"", "
"0","                                          ""December""))) %>%"
"0","  group_by(month) %>% count(hour) %>%"
"0","  ggplot(aes(x = hour, y = n, color = month)) +"
"0","  geom_line() +"
"0","  labs(title = ""Number of Calls by Hour Grouped by Month"", "
"0","       x = ""Hour of Day"", y = ""Number of Calls"", color = ""Month"") +"
"0","  scale_x_continuous("
"0","    breaks = 0:23, "
"0","    labels = c(""12:00 AM"", ""1:00 AM"", ""2:00 AM"", ""3:00 AM"", ""4:00 AM"", "
"0","               ""5:00 AM"", ""6:00 AM"", ""7:00 AM"", ""8:00 AM"", ""9:00 AM"", "
"0","               ""10:00 AM"", ""11:00 AM"", ""12:00 PM"", ""1:00 PM"", ""2:00 PM"", "
"0","               ""3:00 PM"", ""4:00 PM"", ""5:00 PM"", ""6:00 PM"", ""7:00 PM"", "
"0","               ""8:00 PM"", ""9:00 PM"", ""10:00 PM"", ""11:00 PM""),"
"0","    expand = c(0, 0)"
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    axis.text.x = element_text(angle = 45, hjust = 1, size = 10, color = ""gray30""),"
"0","    panel.grid.major = element_line(color = ""gray90""),"
"0","    panel.grid.minor = element_blank(),"
"0","    panel.background = element_rect(fill = ""white"", color = NA)"
"0","  )"
"0","ggsave(p_hourbymonth, filename = here(""docs"", ""figures"", ""counts_by_hrmonth.png""))"
"0",""
"0","# Plot calls by hour and year"
"0","p_hourbyyear = data %>%"
"0","  group_by(year) %>% count(hour) %>%"
"0","  ggplot(aes(x = hour, y = n, color = factor(year))) +"
"0","  geom_line() +"
"0","  labs(title = ""Number of Calls by Hour Grouped by Year"", "
"0","       x = ""Hour of Day"", y = ""Number of Calls"", color = ""Year"") +"
"0","  scale_x_continuous("
"0","    breaks = 0:23, "
"0","    labels = c(""12:00 AM"", ""1:00 AM"", ""2:00 AM"", ""3:00 AM"", ""4:00 AM"", "
"0","               ""5:00 AM"", ""6:00 AM"", ""7:00 AM"", ""8:00 AM"", ""9:00 AM"", "
"0","               ""10:00 AM"", ""11:00 AM"", ""12:00 PM"", ""1:00 PM"", ""2:00 PM"", "
"0","               ""3:00 PM"", ""4:00 PM"", ""5:00 PM"", ""6:00 PM"", ""7:00 PM"", "
"0","               ""8:00 PM"", ""9:00 PM"", ""10:00 PM"", ""11:00 PM""),"
"0","    expand = c(0, 0)"
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme("
"0","    axis.text.x = element_text(angle = 45, hjust = 1, size = 10, color = ""gray30""),"
"0","    panel.grid.major = element_line(color = ""gray90""),"
"0","    panel.grid.minor = element_blank(),"
"0","    panel.background = element_rect(fill = ""white"", color = NA)"
"0","  )"
"0","ggsave(p_hourbyyear, filename = here(""docs"", ""figures"", ""counts_by_hryear.png""))"
"0",""
"0","# Next, we explore whether holidays have an impact on the number of calls"
"0","# List of US holidays"
"0","us_holidays <- as.Date(holidayNYSE(unique(year(data$dispatched))))"
"0",""
"0","# Add holiday indicator"
"0","data <- data %>%"
"0","  mutate(is_holiday = if_else(dispatched %in% us_holidays, 1, 0))"
"0",""
"0","# Total number of days in the dataset"
"0","total_days <- data %>%"
"0","  summarise(days = n_distinct(dispatched)) %>%"
"0","  pull(days)"
"0",""
"0","# Number of holiday days"
"0","num_holiday_days <- data %>%"
"0","  filter(is_holiday == 1) %>%"
"0","  summarise(days = n_distinct(dispatched)) %>%"
"0","  pull(days)"
"0",""
"0","# Number of non-holiday days"
"0","num_non_holiday_days <- total_days - num_holiday_days"
"0",""
"0","cat(""Total Days:"", total_days, ""\n"")"
"1","Total Days:"
"1"," "
"1","3313"
"1"," "
"1","
"
"0","cat(""Holiday Days:"", num_holiday_days, ""\n"")"
"1","Holiday Days:"
"1"," "
"1","83"
"1"," "
"1","
"
"0","cat(""Non-Holiday Days:"", num_non_holiday_days, ""\n"")"
"1","Non-Holiday Days:"
"1"," "
"1","3230"
"1"," "
"1","
"
"0","# Total calls on holidays"
"0","total_calls_holiday <- data %>%"
"0","  filter(is_holiday == 1) %>%"
"0","  summarise(total_calls = n()) %>%"
"0","  pull(total_calls)"
"0",""
"0","# Total calls on non-holidays"
"0","total_calls_non_holiday <- data %>%"
"0","  filter(is_holiday == 0) %>%"
"0","  summarise(total_calls = n()) %>%"
"0","  pull(total_calls)"
"0",""
"0","# Average calls per holiday"
"0","avg_calls_per_holiday <- total_calls_holiday / num_holiday_days"
"0",""
"0","# Average calls per non-holiday"
"0","avg_calls_per_non_holiday <- total_calls_non_holiday / num_non_holiday_days"
"0",""
"0","cat(""Average Calls per Holiday:"", avg_calls_per_holiday, ""\n"")"
"1","Average Calls per Holiday:"
"1"," "
"1","6.421687"
"1"," "
"1","
"
"0","cat(""Average Calls per Non-Holiday:"", avg_calls_per_non_holiday, ""\n"")"
"1","Average Calls per Non-Holiday:"
"1"," "
"1","6.081424"
"1"," "
"1","
"
"0","# Create a data frame for plotting"
"0","holiday_avg_calls <- tibble("
"0","  Day_Type = c(""Holiday"", ""Non-Holiday""),"
"0","  Average_Calls = c(avg_calls_per_holiday, avg_calls_per_non_holiday)"
"0",")"
"0",""
"0","# Plot calls by holiday indicator"
"0","p_holiday = data %>%"
"0","  count(is_holiday) %>%"
"0","  ggplot(aes(x = factor(is_holiday, labels = c(""Non-Holiday"", ""Holiday"")), y = n)) +"
"0","  geom_bar(stat = ""identity"", fill = ""steelblue"") +"
"0","  labs(title = ""Number of Calls Per Day on Holidays vs Non-Holidays"", x = ""Day Type"", y = ""Number of Calls"") + theme_minimal()"
"0",""
"0","ggsave(p_holiday, filename = here(""docs"", ""figures"", ""counts_by_holiday.png""))"
"0",""
"0","# Plot calls per day on holidays vs non-holidays"
"0","p_avgholiday = holiday_avg_calls %>%"
"0","  ggplot(aes(x = Day_Type, y = Average_Calls, fill = Day_Type)) +"
"0","  geom_bar(stat = ""identity"", fill = ""steelblue"") +"
"0","  labs(title = ""Average Calls per Day: Holidays vs Non-Holidays"", x = ""Day Type"", y = ""Average Calls per Day"") +"
"0","  theme_minimal()"
"0","ggsave(p_avgholiday, filename = here(""docs"", ""figures"", ""avgcounts_by_holiday.png""))"
